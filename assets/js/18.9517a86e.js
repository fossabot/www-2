(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{395:function(e,t,s){"use strict";s.r(t);var a=s(2),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[e._v("In this guide, you'll learn how to set up a VPS server from scratch on DigitalOcean's platform, which is equipped with Apache, HTTP/2 support, PHP 7.2, MariaDB, SSL certificates and ModSecurity (OWASP rules).")]),e._v(" "),s("p",[s("span",{staticStyle:{color:"maroon","font-weight":"bold"}},[e._v("Beware: This is a super comprehensive guide.")])]),e._v(" "),s("p",[e._v("A while ago, my bare-metal server died. After running a backup server on a Raspberry Pi, I decided to rent a VPS at DigitalOcean and migrate my old stuff there. Therefore, I wrote this tutorial both to help myself and others to set up a new Ubuntu VPS at DigitalOcean.")]),e._v(" "),s("p",[e._v("Some steps in this tutorial could differ according to your particular preferences at DigitalOcean, e.g. when you are already familiar with SSH keys.")]),e._v(" "),s("h1",{attrs:{id:"_1-create-a-new-droplet"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-create-a-new-droplet"}},[e._v("#")]),e._v(" 1 Create a new droplet")]),e._v(" "),s("p",[e._v("The first thing you should do is creating a new droplet on DigitalOcean. Choosing the latest LTS-release of Ubuntu Server is the best decision.")]),e._v(" "),s("blockquote",[s("p",[e._v("Note: LTS is the abbreviation of "),s("strong",[e._v("L")]),e._v("ong "),s("strong",[e._v("T")]),e._v("erm "),s("strong",[e._v("S")]),e._v("upport, which means that the server software is maintained for a longer period of time and that (future) security issues will be resolved as well.")])]),e._v(" "),s("h1",{attrs:{id:"_2-connect-for-the-first-time"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-connect-for-the-first-time"}},[e._v("#")]),e._v(" 2 Connect for the first time")]),e._v(" "),s("p",[e._v("After you created a new DigtalOcean droplet, connect to it using SSH. Windows users could use PuTTY for this, Linux and macOS-users should use the terminal.")]),e._v(" "),s("p",[e._v("You'll be asked to change the root password upon your first login. Change the password to something secure and write it down.")]),e._v(" "),s("blockquote",[s("p",[e._v("Notes:")]),e._v(" "),s("ol",[s("li",[e._v("Don't make your life hard by choosing a password like "),s("code",[e._v("3uor2jofn2oi45r")]),e._v(". A secure password is actually called a pass"),s("strong",[e._v("phrase")]),e._v(" and consists of multiple, randomly chosen words. (e.g. "),s("code",[e._v("eastbound sibling banana survey")]),e._v(")")]),e._v(" "),s("li",[e._v("If you already have added one or multiple public SSH key(s) to your account, you won't  be asked to change your password. Proceed to the next step.")])])]),e._v(" "),s("h1",{attrs:{id:"_3-enhance-the-overall-server-security"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-enhance-the-overall-server-security"}},[e._v("#")]),e._v(" 3 Enhance the overall server security")]),e._v(" "),s("p",[e._v("To make your server more secure, it is advised to change a few default things.")]),e._v(" "),s("h2",{attrs:{id:"hide-ssh-a-bit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hide-ssh-a-bit"}},[e._v("#")]),e._v(" Hide SSH a bit")]),e._v(" "),s("p",[e._v("The default listening port for SSH is "),s("code",[e._v("22")]),e._v(". It is advised to change this, because it is a well known port that gets scanned by malicious parties, which will try to log in to your system.")]),e._v(" "),s("p",[e._v("Edit the file "),s("code",[e._v("/etc/ssh/sshd_config")]),e._v(", e.g. by using nano: "),s("code",[e._v("nano /etc/ssh/sshd_config")]),e._v(".")]),e._v(" "),s("ul",[s("li",[e._v("In "),s("code",[e._v("/etc/sshd/sshd_config")]),e._v(", change the following lines:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Port 22\n")])])]),s("p",[e._v("to something like")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Port 60022\n")])])]),s("blockquote",[s("p",[e._v("Note: Any port between 1023-65535 will work, as long as it is not in use by another application. Remember this port. Write it down somewhere.")])]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Save the configuration file ("),s("code",[e._v("Control-X")]),e._v(" followed by "),s("code",[e._v("Y")]),e._v(" if you're using "),s("code",[e._v("nano")]),e._v(").")])]),e._v(" "),s("li",[s("p",[e._v("Restart the SSH daemon: "),s("code",[e._v("service sshd restart")]),e._v(".")])]),e._v(" "),s("li",[s("p",[e._v("Open an extra terminal window and try to connect to your server, using the new port.")]),e._v(" "),s("blockquote",[s("p",[e._v("Note:")]),e._v(" "),s("p",[e._v("Windows-users: Open a new PuTTY window.")]),e._v(" "),s("p",[e._v("Linux and macOS users: "),s("code",[e._v("ssh root@<server ip> -p <port number>")]),e._v(".")])])])]),e._v(" "),s("h2",{attrs:{id:"use-public-key-authentication"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#use-public-key-authentication"}},[e._v("#")]),e._v(" Use Public Key Authentication")]),e._v(" "),s("p",[e._v("Public Key Authentication is a well-known and secure way of authentication and is preferred for the following reasons:")]),e._v(" "),s("ol",[s("li",[e._v('It is easier than remembering a password. – You\'re only using a "certificate file" to authenticate and log in.')]),e._v(" "),s("li",[e._v("You could create and use as many public keys as you want. – One for your computer at home, one for the computer at work, one for your notebook, one for your smart phone.")]),e._v(" "),s("li",[e._v("Certificates are cryptographically more secure. – A computer guesses a 40 bit human made up password/-phrase within minutes, a 2048 bit certificate would take much more time.")]),e._v(" "),s("li",[e._v("You could make keys unusable by removing a single line. – One of your devices got stolen? Remove the particular public key line from your droplet and all future access is denied.")]),e._v(" "),s("li",[e._v("Easier sharing and collaboration. – If you want to give someone else access, add their public key. No password sharing, no password leaking.")])]),e._v(" "),s("p",[e._v("Public key "),s("em",[e._v("pairs")]),e._v(" always consist of two parts:")]),e._v(" "),s("ul",[s("li",[e._v("A private key — which you should keep for yourself and never share with someone else.")]),e._v(" "),s("li",[e._v("A public key — which you could share.")])]),e._v(" "),s("h3",{attrs:{id:"generating-new-ssh-key-pairs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#generating-new-ssh-key-pairs"}},[e._v("#")]),e._v(" Generating new SSH key pairs")]),e._v(" "),s("p",[e._v("The first step is to generate a public key pair to be used for authentication purposes.")]),e._v(" "),s("p",[s("strong",[e._v("Windows users")])]),e._v(" "),s("p",[e._v("Windows users could use PuTTYgen to generate a new key pair.")]),e._v(" "),s("p",[s("strong",[e._v("Linux and macOS users")])]),e._v(" "),s("p",[e._v("On Linux and macOS you could generate a new SSH key via terminal commands:")]),e._v(" "),s("ul",[s("li",[e._v("Use "),s("code",[e._v("ssh-keygen -t ed25519 -C 'Name of the new key'")]),e._v(" to generate a new key pair. "),s("code",[e._v("ssh-keygen")]),e._v(" saves the public key to "),s("code",[e._v("~/.ssh/id_ed25519.pub")])]),e._v(" "),s("li",[e._v("Execute "),s("code",[e._v("cat ~/.ssh/id_ed25519.pub")]),e._v(", it will show you your public key. Copy the output to the clipboard.")])]),e._v(" "),s("blockquote",[s("p",[e._v("Notes:")]),e._v(" "),s("ol",[s("li",[s("code",[e._v("~/")]),e._v(" is shorthand Unix (Linux/macOS) slang for the directory "),s("code",[e._v("/home/your-username/")]),e._v(".")]),e._v(" "),s("li",[e._v("Adding a name is not required but recommended, it makes differentiating multiple keys a lot easier, e.g. "),s("code",[e._v("ssh-keygen -t ed25519 -C 'Computer-Home'")]),e._v(".")]),e._v(" "),s("li",[e._v("The "),s("em",[e._v("private key")]),e._v(" is located at "),s("code",[e._v("~/.ssh/id_ed25519")]),e._v(" (without "),s("code",[e._v(".pub")]),e._v("), the "),s("em",[e._v("public key")]),e._v(" is located at "),s("code",[e._v("~/.ssh/id_ed25519.pub")]),e._v(".")])])]),e._v(" "),s("h3",{attrs:{id:"adding-keys-to-your-digitalocean-droplet"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#adding-keys-to-your-digitalocean-droplet"}},[e._v("#")]),e._v(" Adding keys to your DigitalOcean droplet")]),e._v(" "),s("p",[e._v("To add the key")]),e._v(" "),s("ul",[s("li",[e._v("Log in to the server")]),e._v(" "),s("li",[e._v("Edit "),s("code",[e._v("~/.ssh/authorized_keys")])]),e._v(" "),s("li",[e._v("Paste the public key.")])]),e._v(" "),s("h3",{attrs:{id:"change-the-authentication-method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#change-the-authentication-method"}},[e._v("#")]),e._v(" Change the authentication method")]),e._v(" "),s("p",[e._v("The next step is to disable the usage of password login and move to a safer (public key based) approach.")]),e._v(" "),s("p",[e._v("In "),s("code",[e._v("/etc/sshd/sshd_config")]),e._v(" on the server, you'll need to change the following lines:")]),e._v(" "),s("p",[s("strong",[e._v("Enabling public key authentication:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("#PubkeyAuthentication yes\n")])])]),s("p",[e._v("should become")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("PubkeyAuthentication yes\n")])])]),s("p",[s("strong",[e._v("Disabling password authentication:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("#PasswordAuthentication yes\n")])])]),s("p",[e._v("should become")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("PasswordAuthentication no\n")])])]),s("h3",{attrs:{id:"restart-the-ssh-daemon"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#restart-the-ssh-daemon"}},[e._v("#")]),e._v(" Restart the SSH daemon")]),e._v(" "),s("p",[s("code",[e._v("sudo service sshd restart")])]),e._v(" "),s("p",[e._v("Done!")]),e._v(" "),s("blockquote",[s("p",[e._v("Note: Always check if logging in still works with the new settings via an additional terminal window.")])]),e._v(" "),s("h1",{attrs:{id:"_4-create-user-accounts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-create-user-accounts"}},[e._v("#")]),e._v(" 4 Create User Accounts")]),e._v(" "),s("p",[e._v("DigitalOcean servers use the root account by default. That's not quite secure by design, because it does not conform to the principle of 'least privilege'.")]),e._v(" "),s("p",[e._v("The best thing to do is to create an additional user which does not have root privileges by default but could gather those privileges by issuing the "),s("code",[e._v("sudo")]),e._v(" command.")]),e._v(" "),s("h2",{attrs:{id:"adding-an-additional-user"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#adding-an-additional-user"}},[e._v("#")]),e._v(" Adding an additional user")]),e._v(" "),s("p",[e._v("While still being logged in to your droplet as root user, issue the following commands.")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("useradd sysadmin")]),e._v(", which will create the new user "),s("code",[e._v("sysadmin")]),e._v(".")]),e._v(" "),s("li",[s("code",[e._v("passwd sysadmin")]),e._v(", which will set up a password. This password is needed when the new user "),s("code",[e._v("sysadmin")]),e._v(" invokes a "),s("code",[e._v("sudo")]),e._v(" command. Use a strong password and write it down somewhere.")]),e._v(" "),s("li",[s("code",[e._v("usermod -a -G sudo sysadmin")]),e._v(", which will grant "),s("code",[e._v("sysadmin")]),e._v(" the rights to issue "),s("code",[e._v("sudo")]),e._v(" commands.")]),e._v(" "),s("li",[s("code",[e._v("mkdir /home/sysadmin")]),e._v(", which will make a new home directory.")]),e._v(" "),s("li",[s("code",[e._v("chown -R sysadmin /home/sysadmin")]),e._v(", which will set the correct permissions in the new directory.")])]),e._v(" "),s("blockquote",[s("p",[e._v("NOTE: Change the username "),s("code",[e._v("sysadmin")]),e._v(" to something else if you have something different in mind, e.g. "),s("code",[e._v("devteam")]),e._v(" or "),s("code",[e._v("voldermort")]),e._v(".")])]),e._v(" "),s("h2",{attrs:{id:"adding-another-public-key"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#adding-another-public-key"}},[e._v("#")]),e._v(" Adding another public key")]),e._v(" "),s("p",[e._v("Previously, you enabled Public Key Authentication (section 3.2) and it's the only way to log in to your server. This means that you should add a public key to the newly created user as well.")]),e._v(" "),s("p",[e._v("Depending on your situation, you could choose to")]),e._v(" "),s("ul",[s("li",[e._v("Generate a new private / public key pair to be able to log in as this new user. This is recommended, because you still have a key pair for the "),s("code",[e._v("root")]),e._v(" user as backup.")]),e._v(" "),s("li",[e._v("Move the "),s("code",[e._v("root")]),e._v(" key pair to this new user. This is less recommended, because this could lock you out unintentionally. But it is quite secure, as it means that practically no one could log in directly as root user."),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("mkdir /home/sysadmin/.ssh/\nmv ~/.ssh/authorized_keys /home/sysadmin/.ssh/authorized_keys\nchown sysadmin /home/sysadmin/.ssh/authorized_keys\n")])])])]),e._v(" "),s("li",[s("s",[e._v("Use the same key as the one for the "),s("code",[e._v("root")]),e._v(" user.")]),e._v(" That is a "),s("strong",[e._v("terrible")]),e._v(" decision.")])]),e._v(" "),s("h2",{attrs:{id:"test-the-new-user-account"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#test-the-new-user-account"}},[e._v("#")]),e._v(" Test the new user account")]),e._v(" "),s("p",[e._v("Try to log in to your new user, using the new key, e.g. in a separate terminal.")]),e._v(" "),s("p",[s("code",[e._v("ssh sysadmin@<server ip> -p 60022")])]),e._v(" "),s("p",[e._v("Try to issue a sudo command. Quick hint: "),s("code",[e._v('sudo echo "It works" || echo "It doesn\'t work"')])]),e._v(" "),s("h1",{attrs:{id:"_5-firewall"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-firewall"}},[e._v("#")]),e._v(" 5 Firewall")]),e._v(" "),s("p",[e._v("For the firewall, you have two options")]),e._v(" "),s("ul",[s("li",[e._v("The quick and easy way, via the DO configuration panel")]),e._v(" "),s("li",[e._v("The slow and difficult way, which provides you with more advanced features")])]),e._v(" "),s("h2",{attrs:{id:"quick-easy-firewall"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#quick-easy-firewall"}},[e._v("#")]),e._v(" Quick & Easy Firewall")]),e._v(" "),s("p",[e._v("In your DigitalOcean panel, you could go to the networking tab and set up a firewall.")]),e._v(" "),s("h2",{attrs:{id:"advanced-firewall"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#advanced-firewall"}},[e._v("#")]),e._v(" Advanced Firewall")]),e._v(" "),s("p",[e._v("If you want a more secure and advanced approach, follow the instructions below.")]),e._v(" "),s("h3",{attrs:{id:"step-1-reset-clear-the-current-firewall"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-1-reset-clear-the-current-firewall"}},[e._v("#")]),e._v(" Step 1: Reset & clear the current firewall")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -P INPUT ACCEPT\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -F\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables -P INPUT ACCEPT\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables -F\n")])])]),s("h3",{attrs:{id:"step-2-accept-outbound-connections"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-2-accept-outbound-connections"}},[e._v("#")]),e._v(" Step 2: Accept outbound connections")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -A INPUT -i lo -j ACCEPT\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables -A INPUT -i lo -j ACCEPT\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n")])])]),s("h3",{attrs:{id:"step-3-set-a-maximum-number-of-connections-on-specific-ports"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-3-set-a-maximum-number-of-connections-on-specific-ports"}},[e._v("#")]),e._v(" Step 3: Set a maximum number of connections on specific ports")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -A INPUT -p tcp --syn --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v(" -m connlimit --connlimit-above "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v(" -j REJECT --reject-with tcp-reset\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -A INPUT -p tcp --syn --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("443")]),e._v(" -m connlimit --connlimit-above "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(" -j REJECT --reject-with tcp-reset\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables -A INPUT -p tcp --syn --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v(" -m connlimit --connlimit-above "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v(" -j REJECT --reject-with tcp-reset\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables -A INPUT -p tcp --syn --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("443")]),e._v(" -m connlimit --connlimit-above "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(" -j REJECT --reject-with tcp-reset\n")])])]),s("h3",{attrs:{id:"step-4-accept-the-connections-that-not-have-been-rejected"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-4-accept-the-connections-that-not-have-been-rejected"}},[e._v("#")]),e._v(" Step 4: Accept the connections that not have been rejected")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -A INPUT -p tcp --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v(" -j ACCEPT\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -A INPUT -p tcp --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("443")]),e._v(" -j ACCEPT\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables -A INPUT -p tcp --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v(" -j ACCEPT\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables -A INPUT -p tcp --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("443")]),e._v(" -j ACCEPT\n")])])]),s("h3",{attrs:{id:"step-5-accept-connections-from-specific-hosts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-5-accept-connections-from-specific-hosts"}},[e._v("#")]),e._v(" Step 5: Accept connections from specific hosts")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -A INPUT -p tcp -s "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("123.456")]),e._v(".789.0/24 --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("60022")]),e._v(" -j ACCEPT\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables -A INPUT -p tcp -s "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("123.456")]),e._v(".789.0/24 --dport "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("60022")]),e._v(" -j ACCEPT\n")])])]),s("h3",{attrs:{id:"step-6-set-the-end-policy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-6-set-the-end-policy"}},[e._v("#")]),e._v(" Step 6: Set the end policy")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -P INPUT DROP\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -P FORWARD DROP\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables -P OUTPUT ACCEPT\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables -P INPUT DROP\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables -P FORWARD DROP\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables -P OUTPUT ACCEPT\n")])])]),s("h3",{attrs:{id:"step-7-making-the-configuration-permanent"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#step-7-making-the-configuration-permanent"}},[e._v("#")]),e._v(" Step 7: Making the configuration permanent")]),e._v(" "),s("p",[e._v("By default, all firewall rules of "),s("code",[e._v("iptables")]),e._v(" will be forgotten after a system reboot. This means that the firewall rules have to be re-initialized on each restart.")]),e._v(" "),s("p",[e._v("To make it easier to save and restore firewall rules, there are two tools available on Linux: "),s("code",[e._v("iptables-save")]),e._v(" for IPv4 rules and "),s("code",[e._v("ip6tables-save")]),e._v(" for IPv6.")]),e._v(" "),s("h4",{attrs:{id:"saving-the-current-firewall-rules"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#saving-the-current-firewall-rules"}},[e._v("#")]),e._v(" Saving the current firewall rules")]),e._v(" "),s("p",[e._v("The first thing to do is to save the current firewall rules. The rules will be saved in the directory "),s("code",[e._v("/etc/iptables/")]),e._v(".")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" /etc/iptables\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" iptables-save "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("tee")]),e._v(" /etc/iptables/rules.v4\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" ip6tables-save "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("tee")]),e._v(" /etc/iptables/rules.v6\n")])])]),s("blockquote",[s("p",[e._v("Note: "),s("code",[e._v("sudo tee")]),e._v(" makes it possible to directly save the output files to a directory owned by root, that is the reason why this is used here instead of regular file redirection ("),s("code",[e._v(">")]),e._v(").")])]),e._v(" "),s("h4",{attrs:{id:"automatically-reloading-at-startup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#automatically-reloading-at-startup"}},[e._v("#")]),e._v(" Automatically reloading at startup")]),e._v(" "),s("p",[e._v("It is cool that the current firewall rules are saved, but they still need to be restored at system startup somehow. This is done with a "),s("code",[e._v("systemd")]),e._v(" unit, which will run the necessary stuff after network interfaces have been set up.")]),e._v(" "),s("p",[e._v("Create the following file: "),s("code",[e._v("/etc/systemd/system/restore-firewall-on-boot.service")])]),e._v(" "),s("p",[e._v("Put this inside:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("[Unit]\n  Description=Restore Firewall Rules\n  After=network.target\n\n[Service]\n  Type=oneshot\n  ExecStart=/sbin/iptables-restore /etc/iptables/rules.v4\n  ExecStart=/sbin/ip6tables-restore /etc/iptables/rules.v6\n  RemainAfterExit=yes\n\n[Install]\n  WantedBy=multi-user.target\n")])])]),s("p",[e._v("Enable the new "),s("code",[e._v("systemd")]),e._v(" unit...")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("enable")]),e._v(" restore-firewall-on-boot\n")])])]),s("p",[e._v("Bam! The firewall rules will be restored at boot time, after the networking devices have been initialized.")]),e._v(" "),s("h1",{attrs:{id:"_6-automatic-upgrades"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-automatic-upgrades"}},[e._v("#")]),e._v(" 6 Automatic upgrades")]),e._v(" "),s("p",[e._v("For production environments, it is important that a system stays secure. This could be achieved with unattended upgrades.")]),e._v(" "),s("p",[e._v("On the server, execute "),s("code",[e._v("sudo apt install unattended-upgrades")]),e._v(" to install this functionality.")]),e._v(" "),s("p",[e._v("After installing, execute "),s("code",[e._v("sudo crontab -e")]),e._v(" and add the following line:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("0 0 * * * unattended-upgrade\n")])])]),s("p",[e._v("This will add a task performing automatic system updates each day at 12:00 AM.")]),e._v(" "),s("h1",{attrs:{id:"_7-installation-of-server-applications"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-installation-of-server-applications"}},[e._v("#")]),e._v(" 7 Installation of server applications")]),e._v(" "),s("p",[e._v("Now we have finally installed and configured the base server, let's take a shot on the application-side.")]),e._v(" "),s("p",[e._v("We're going to install Apache, PHP 7.2 and ModSecurity. But before we're going to do anything, make sure that the software repositories are up-to-date.")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" update "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" upgrade\n")])])]),s("h2",{attrs:{id:"installation-of-apache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation-of-apache"}},[e._v("#")]),e._v(" Installation of Apache")]),e._v(" "),s("p",[e._v("Installing Apache isn't that hard...")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" -y apache2\n")])])]),s("p",[e._v("Check if the server is accessible.")]),e._v(" "),s("h2",{attrs:{id:"installation-of-php-7-2-php7-2-fpm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation-of-php-7-2-php7-2-fpm"}},[e._v("#")]),e._v(" Installation of PHP 7.2 (php7.2-fpm)")]),e._v(" "),s("p",[e._v("The below command could be used to install PHP 7.2.")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" -y php7.2 php7.2-fpm php7.2-curl php7.2-gd php7.2-json php7.2-mysql php7.2-xml\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" a2enmod proxy_fcgi setenvif\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" a2enconf php7.2-fpm\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("service")]),e._v(" apache2 restart\n")])])]),s("p",[e._v("Create the file "),s("code",[e._v("/var/www/html/index.php")]),e._v(" and add the following code:")]),e._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[e._v("<?")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("phpinfo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[e._v("?>")])]),e._v("\n")])])]),s("p",[e._v("Go to "),s("code",[e._v("http://<host ip>/index.php")]),e._v(", and check if PHP 7.2 was installed successfully.")]),e._v(" "),s("p",[e._v("If it works, you could remove the file again.")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("rm")]),e._v(" /var/www/html/index.php\n")])])]),s("h2",{attrs:{id:"installation-of-modsecurity-owasp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation-of-modsecurity-owasp"}},[e._v("#")]),e._v(" Installation of ModSecurity OWASP")]),e._v(" "),s("p",[e._v("ModSecurity is a Web Application Firewall that prevents malicious parties (scriptkiddies) from doing weird stuff on your server. OWASP is an abbreviation for "),s("em",[e._v("Open Web Application Security Project")]),e._v(". The OWASP-CRS (Core Rule Set) is an open source rule set for ModSecurity that has a good balance between security and usability.")]),e._v(" "),s("p",[e._v("Install ModSecurity with the OWASP CRS.")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" libapache2-mod-security2 modsecurity-crs\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" /etc/modsecurity/modsecurity.conf-recommended /etc/modsecurity/modsecurity.conf\n")])])]),s("p",[e._v("The next step is to actually enable ModSecurity.")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("nano")]),e._v(" /etc/modsecurity/modsecurity.conf\n")])])]),s("p",[e._v("Change the line")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("SecRuleEngine DetectionOnly\n")])])]),s("p",[e._v("to")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("SecRuleEngine On\n")])])]),s("p",[e._v("Then, restart Apache with ModSecurity")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" a2enmod security2\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("service")]),e._v(" apache2 restart\n")])])]),s("p",[e._v("Done.")]),e._v(" "),s("blockquote",[s("p",[e._v("Note: If you are working with REST-based applications, ModSecurity could fuck up some things. So if your web application is not working, temporarily disable ModSecurity with "),s("code",[e._v("sudo a2dismod security2")]),e._v(".")])]),e._v(" "),s("h3",{attrs:{id:"changing-the-server-signature"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#changing-the-server-signature"}},[e._v("#")]),e._v(" Changing the Server Signature")]),e._v(" "),s("p",[e._v("A nice thing to do with ModSecurity is changing the server signature, so that it is impossible for others to see which server software and version is running on your machine.")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("nano")]),e._v(" /etc/apache2/conf-available/Security-Change-ServerSig.conf\n")])])]),s("p",[e._v("Put this inside:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("<IfModule mod_security2.c>\n    ServerTokens Full\n    SecServerSignature Unix\n</IfModule>\n")])])]),s("p",[e._v("And restart the server...")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("service")]),e._v(" apache2 restart\n")])])]),s("blockquote",[s("p",[e._v("Hint: If you're using Linux, you could check the response headers from a server with the following command: "),s("code",[e._v("curl -IL example.com")]),e._v(".")])]),e._v(" "),s("h2",{attrs:{id:"installation-of-mariadb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation-of-mariadb"}},[e._v("#")]),e._v(" Installation of MariaDB")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" -y mariadb-server\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" mysql_secure_installation\n")])])]),e._v(" "),s("h2",{attrs:{id:"installation-of-certbot-let-s-encrypt"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation-of-certbot-let-s-encrypt"}},[e._v("#")]),e._v(" Installation of Certbot (Let's Encrypt)")]),e._v(" "),s("p",[e._v("To get a free Let's Encrypt Certificate, use "),s("code",[e._v("certbot")]),e._v(". Installation is done via "),s("code",[e._v("apt")]),e._v(".")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" certbot\n")])])]),s("p",[e._v("For further instructions how to use Certbot, check https://certbot.eff.org/")]),e._v(" "),s("p",[e._v("After Let's Encrypt is set up, it is advised to automatically renew all certificates. There are different ways to do it, but I'll use "),s("code",[e._v("cron")]),e._v(".")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("crontab")]),e._v(" -e\n")])])]),s("p",[e._v("Add the following line to automatically check all certificates at 3:00 AM each day:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("0 3 * * * certbot renew\n")])])]),s("blockquote",[s("p",[e._v("Note: Certbot automatically renews certificates when it is needed.")])]),e._v(" "),s("h2",{attrs:{id:"enabling-http-2-support"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#enabling-http-2-support"}},[e._v("#")]),e._v(" Enabling HTTP/2 support")]),e._v(" "),s("p",[e._v('HTTP/2 makes your website faster by pipelining all requests (to a particular server) over a single TCP connection and minimizing the overhead by talking "in binary" format directly.')]),e._v(" "),s("p",[e._v("All files (images, svgs, videos etc.) are served over a single connection, which means that there won't be an SSL negotiation delay for each single file. After all, more connections stay available to serve other people.")]),e._v(" "),s("p",[e._v("Enable the HTTP/2 module in Apache.")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" a2enmod http2\n")])])]),s("p",[e._v("Add the following line to the SSL VirtualHost(s) that need support HTTP/2:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Protocols h2 http/1.1\n")])])]),s("p",[e._v("An example would be:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("<VirtualHost *:443>\n  Protocols h2 http/1.1\n  ServerAdmin you@your-awesome-site.com\n  ServerName your-awesome-site.com\n  ...\n</VirtualHost>\n")])])]),s("blockquote",[s("p",[e._v("Important note: HTTP/2 only works with SSL. So use them on your SSL VirtualHost(s) only, usually the ones using port "),s("code",[e._v("443")]),e._v(".")])]),e._v(" "),s("h1",{attrs:{id:"tips-and-enhancements"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tips-and-enhancements"}},[e._v("#")]),e._v(" Tips and Enhancements")]),e._v(" "),s("h2",{attrs:{id:"periodic-backups"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#periodic-backups"}},[e._v("#")]),e._v(" Periodic Backups")]),e._v(" "),s("p",[e._v("It is recommended to perform automatic periodic backups.")]),e._v(" "),s("h1",{attrs:{id:"references"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),s("p",[e._v("Karunaratne, A. (2017, November 5). "),s("em",[e._v("How to enable HTTP/2 support in Apache")]),e._v(". Retrieved January 13, 2018, from https://http2.pro/doc/Apache")]),e._v(" "),s("p",[e._v("Svoboda, P. (2012, May 14). "),s("em",[e._v("Laptop, SSD, tmpfs and Apache")]),e._v(". Retrieved January 13, 2018, from https://weits.blogspot.ch/2012/03/laptop-ssd-tmpfs-and-apache.html")]),e._v(" "),s("p",[s("em",[e._v("Tar archiving that takes input from a list of files")]),e._v(". (n.d.). Retrieved January 13, 2018, from https://stackoverflow.com/questions/8033857/tar-archiving-that-takes-input-from-a-list-of-files#8033898")])])}),[],!1,null,null,null);t.default=n.exports}}]);